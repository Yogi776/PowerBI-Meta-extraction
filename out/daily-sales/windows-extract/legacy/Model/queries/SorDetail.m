let
    Source = Sql.Database("nausawsdb004.harmar.lan", "Harmar"),
    dbo_SorDetail = Source{[Schema="dbo",Item="SorDetail"]}[Data],
    #"Removed Columns" = Table.RemoveColumns(dbo_SorDetail,{"TpmTrnWork", "WhmBin", "WhmPickDetail", "WhmPickMaster", "WipArcMaster", "WipInspect", "WipMaster", "TpmPromoDetTrans", "TpmPromotion", "TpmPromotionLimit", "TblSoPriceUom", "TblSoReason", "TblSoXrfPrcCur", "TblPoPriceUom", "TblSoBuyingGroup", "TblSoCommission", "SorLostSales", "SorRouteSoDetail", "SorDetailSer", "SorDetailSerRep", "SorLoadSoHeader", "SorDetailLotRep", "SorDetailQtyBal", "SorDetailQtyBalFix", "SorDetailRep", "SorDeliveryPerf", "SorDetailBin", "SorDetailBinRep", "SorDetailLot", "ReqDetail", "RmaCrossShipment", "RmaDetail", "RtsLastPrice", "SalEcSales", "PrjPartBill", "PrjRetentionDetail", "QotNonStock", "PosDeposit", "PrjContMaster", "PrjOrdLinHier", "MrpSugReqDetail", "MrpWipInspect", "PorMasterDetail", "MrpReqDetail", "MrpSugGtrDetail", "MrpSugJobMaster", "MrpJobMaster", "MrpPoMasterDet", "MrpQotNonStock", "MdnDetailSerRep", "MdnDetailSerRepCon", "MrpGtrDetail", "MdnDetailRepCon", "MdnDetailSer", "MdnDetailSerCons", "MdnDetailLotRep", "MdnDetailLotRepCon", "MdnDetailRep", "MdnDetailCons", "MdnDetailLot", "MdnDetailLotCons", "MdnDetailBinCons", "MdnDetailBinRep", "MdnDetailBinRepCon", "LotTransactions", "MdnDetail", "MdnDetailBin", "IopWarehouse", "LotArcTransact", "LotArcWipInsp", "InvWhControl", "InvWhatIfCost", "IopProxies", "InvStockTake", "InvWarehouse", "InvWhBin", "InvMaster", "InvMultBin", "InvPrice", "EccRevHistoryCost", "GtrDetail", "IntEdiXref", "CfgProductMaster", "EccDrawStock", "EccRevHistory", "ArSalesMove", "ArTrnDetail", "ArcJobRef", "AdmTaxAuditLog", "AdmTaxExt", "AdmTaxFltrPcls", "AdmAltTax", "AdmTax", "TriangDestState", "OrigCountry", "PriceGroupRule", "IntrastatExempt", "TriangulationRole", "TriangDispState", "QtyReleasedToPick", "PickNumber", "TimeStamp", "SalesOrderDetStat", "SalesOrderResStat", "QtyReservedShip", "TpmSequence", "SalesOrderInitLine", "PreactorPriority", "OrigShipDateAps", "TpmUsageFlag", "PromotionCode", "MultiShipCode", "User1", "CreditReason", "ScrapQuantity", "FixedQtyPerFlag", "FixedQtyPer", "LibraryCode", "MaterialAllocLine", "NChargeCode", "IncludeInMrp", "NRetentionJob", "NSrvMinQuantity", "NTaxAmountFlag", "NDepRetFlagProj", "NPrtOnDel", "NPrtOnAck", "NSrvMulDiv", "NPrtOnInv", "NSrvMinValue", "NSrvMaxValue", "NSrvDecimalRnd", "NSrvDecRndFlag", "NSrvQtyFactor", "NSrvApplyFactor", "NSrvUnitPrice", "NSrvUnitCost", "NSrvChargeType", "NSrvParentLine", "NSrvIncTotal", "NSrvSummary", "NCommentTextTyp", "NMscChargeQty", "NMscTaxCode", "NMscFstCode", "NMscInvCharge", "NCommentType", "SalesOrderLine", "LineType", "MWarehouse", "MBin", "MBomFlag", "MParentKitType", "MQtyPer", "MScrapPercentage", "MPrintComponent", "MComponentSeq", "MQtyChangesFlag", "MOptionalFlag", "MDecimals", "MOrderUom", "MStockQtyToShp", "MStockingUom", "MConvFactOrdUm", "MMulDivPrcFct", "MPriceUom", "MCommissionCode", "MDiscPct1", "MDiscPct2", "MDiscPct3", "MDiscValFlag", "MDiscValue", "MTaxCode", "MAllocStatSched", "MFstTaxCode", "MStockUnitMass", "MStockUnitVol", "MPriceCode", "MConvFactAlloc", "MMulDivQtyFct", "MTraceableType", "MMpsFlag", "MPickingSlip", "MMovementReqd", "MSerialMethod", "MZeroQtyCrNote", "MAbcApplied", "MMpsGrossReqd", "MContract", "MBuyingGroup", "MCusSupStkCode", "MCusRetailPrice", "MTariffCode", "MLineReceiptDat", "MLeadTime", "MTrfCostMult", "MSupplementaryUn", "MReviewFlag", "MReviewStatus", "MInvoicePrinted", "MDelNotePrinted", "MOrdAckPrinted", "MHierarchyJob", "MLastDelNote", "MUserDef", "MQtyDispatched", "MDiscChanged", "MCreditOrderNo", "MCreditOrderLine", "MUnitQuantity", "MConvFactUnitQ", "MAltUomUnitQ", "MDecimalsUnitQ", "MEccFlag", "MVersion", "MRelease", "MCommitDate", "QtyReserved", "NCommentFromLin", "NMscChargeCost"}),
    #"Changed Type" = Table.TransformColumnTypes(#"Removed Columns",{{"MLineShipDate", type date}, {"MCustRequestDat", type date}}),
    #"Removed Columns1" = Table.RemoveColumns(#"Changed Type",{"MLineShipDate", "MCustRequestDat"}),
    #"Added Custom" = Table.AddColumn(#"Removed Columns1", "Custom", each [NMscChargeValue]+[MPrice]*[MOrderQty]),
    #"Renamed Columns" = Table.RenameColumns(#"Added Custom",{{"Custom", "Bookings Calculation"}}),
    #"Removed Columns2" = Table.RemoveColumns(#"Renamed Columns",{"Bookings Calculation"}),
    #"Expanded SorMaster" = Table.ExpandRecordColumn(#"Removed Columns2", "SorMaster", {"Customer", "OrderDate"}, {"SorMaster.Customer", "SorMaster.OrderDate"}),
    #"Filtered Rows" = Table.SelectRows(#"Expanded SorMaster", each ([NMscProductCls] <> "_BAD")),
    #"Extracted Last Characters" = Table.TransformColumns(#"Filtered Rows", {{"SorMaster.Customer", each Text.End(_, 7), type text}}),
    #"Merged Queries" = Table.NestedJoin(#"Extracted Last Characters", {"SorMaster.Customer"}, Account, {"AccountNumber"}, "Account", JoinKind.LeftOuter),
    #"Expanded Account" = Table.ExpandTableColumn(#"Merged Queries", "Account", {"Sub_Key_Account__c"}, {"Account.Sub_Key_Account__c"}),
    #"Appended Query" = Table.Combine({#"Expanded Account", #"PRES 2024 Bookings Revenue"})
in
    #"Appended Query"